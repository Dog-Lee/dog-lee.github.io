<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>一起来写最好用的MybatisXML生成工具 | 阿狗</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/basic.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><a id="logo" href="/.">阿狗</a><p class="description">独立博客</p></div><div id="nav-menu"><div class="bitcron_nav_container"><div class="bitcron_nav"><div class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">      <li><a href="/." class="selected active current nav__item">首页</a></li>&nbsp;<li><a href="/archives/" class="nav__item">归档</a></li>&nbsp;<li><a href="/sale/" class="nav__item">闲置转让</a></li>&nbsp;<li><a href="/about/" class="nav__item">关于</a></li>&nbsp;<li><a href="/works/" class="nav__item">作品</a></li>&nbsp;<a href="/resume/" target="_blank" class="nav__item">我的简历</a></ul></div></div></div></div></div><div id="layout"><div class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">一起来写最好用的MybatisXML生成工具</h1><div class="post-meta">2018-02-06<span> | </span><span class="category"><a href="/categories/编程/">编程</a></span></div><div class="post-content"><p>工作之前我个人项目的ORM一直使用JPA，那时我一直认为它很酷，直到工作后手写SQL犯懵时，我才发现我是错的。</p>
<p>Mybatis之所以更为流行是因为学习曲线平缓，维护容易，这对互联网公司实在太重要了，互联网公司的业务调整非常频繁，因为调整业务而增加表字段是常有的事。至此，我开始放弃Hibernate/JPA，拥抱Mybatis，但使用Mybatis都有一个问题，不管在公司写业务代码还是写side project，都需要手写MybatisXML（下文简称XML），写基础的增删改查十分繁琐，当涉及到的实体类与表一多就更加痛苦，如果我一不小心在几个地方写错几个字符，后面单元测试报出的错误常常会令我怀疑自己究竟合不合适写代码。我尝试过一款大家熟知的XML生成工具，但是当XML一出来的时候我完全奔溃了，当然不是说它不好用，而且生成的方法名我一个都不喜欢，而且XML的格式我十分不喜欢， 光是看着就十分难受更何况后期的维护。</p>
<p>在代码洁癖欲的驱动下我只能自己动手写一款XML生成工具了。在公司里DAO类的方法应该遵循公司原有的规约，XML应该格式规范，易于维护。比如有的公司DAO的方法喜欢用find开头，有的遵循阿里规范使用get，list开头。所以工具应该可以根据各自的习惯修改方法名，而且XML内容与格式应该可以自定义。</p>
<p>大家熟知的XML生成工具通过JDBC连接数据库获取表字段信息，再根据字段生成实体类与XML文件，这其实有点过度设计了，而且根本没法定制，代码格式不说，如果实体类继承，比如BaseModel，生成文件修改下来实在不如自己老老实实写一份。能够遵循公司原有代码规约以及根据具体场景定制生成XML，这才是最好用的工具。</p>
<p>假设现在我写好了User实体类与UserDao类，看看如何生成XML吧。</p>
<p>User类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseModel</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line">    <span class="keyword">private</span> Long loginCount;</div><div class="line">    <span class="keyword">private</span> Date loginTime;</div><div class="line">    <span class="keyword">private</span> String countryCode;</div><div class="line">    <span class="keyword">private</span> String phone;</div><div class="line">    <span class="comment">// Getter Setter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DELETED = <span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOT_DELETED = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> Integer id;</div><div class="line">    <span class="keyword">protected</span> Date createTime;</div><div class="line">    <span class="keyword">protected</span> Date updateTime;</div><div class="line">    <span class="keyword">protected</span> Integer status;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseModel</span><span class="params">()</span> </span>&#123; status = NOT_DELETED; &#125;</div><div class="line">    <span class="comment">// Getter Setter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>user表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</div><div class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</div><div class="line">  <span class="string">`login_count`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</div><div class="line">  <span class="string">`country_code`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</div><div class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</div><div class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`update_time`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`status`</span> tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>UserDao类：（QueryCondition是一个分页与查询辅助类）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line">    <span class="function">User <span class="title">getById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(User user)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line">    <span class="function">List&lt;User&gt; <span class="title">listByIds</span><span class="params">(@Param(<span class="string">"ids"</span>)</span> List&lt;Integer&gt; ids)</span>;</div><div class="line">    <span class="function">List&lt;User&gt; <span class="title">list</span><span class="params">(QueryCondition&lt;User&gt; query)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(User user)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>UserDao列出的方法是一些基本的增删改查方法，几乎是所有DAO类都有的方法。</p>
<p>我希望最后生成的XML像这么漂亮：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultType</span>=<span class="string">"top.leeys.codegenerator.User"</span>&gt;</span></div><div class="line">  select * from user where id = #&#123;id&#125; and status = 0;</div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteById"</span>&gt;</span></div><div class="line">  delete from user where id = #&#123;id&#125;;</div><div class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"top.leeys.codegenerator.User"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">    insert into user</div><div class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span>username,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span>password,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginCount != null"</span>&gt;</span>login_count,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginTime != null"</span>&gt;</span>login_time,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"countryCode != null"</span>&gt;</span>country_code,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>phone,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        create_time,</div><div class="line">        update_time,</div><div class="line">        status</div><div class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"values ("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span>#&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span>#&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginCount != null"</span>&gt;</span>#&#123;loginCount&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginTime != null"</span>&gt;</span>#&#123;loginTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"countryCode != null"</span>&gt;</span>#&#123;countryCode&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        now(),</div><div class="line">        now(),</div><div class="line">        0</div><div class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"top.leeys.codegenerator.User"</span>&gt;</span></div><div class="line">    update user</div><div class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span>username = #&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span>password = #&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginCount != null"</span>&gt;</span>login_count = #&#123;loginCount&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginTime != null"</span>&gt;</span>login_time = #&#123;loginTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"countryCode != null"</span>&gt;</span>country_code = #&#123;countryCode&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>phone = #&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        update_time = now()</div><div class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    where id = #&#123;id&#125; and status = 0;</div><div class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listByIds"</span> <span class="attr">resultType</span>=<span class="string">"top.leeys.codegenerator.User"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and !ids.isEmpty()"</span>&gt;</span></div><div class="line">        select * from user where id in </div><div class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">            #&#123;item&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">        and status = 0</div><div class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">  </div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"list"</span> <span class="attr">resultType</span>=<span class="string">"top.leeys.codegenerator.User"</span> &gt;</span></div><div class="line">    select * from user</div><div class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.id != null"</span>&gt;</span>and id = #&#123;model.id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.username != null"</span>&gt;</span>and username = #&#123;model.username&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.password != null"</span>&gt;</span>and password = #&#123;model.password&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.loginCount != null"</span>&gt;</span>and login_count = #&#123;model.loginCount&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.loginTime != null"</span>&gt;</span>and login_time = #&#123;model.loginTime&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.countryCode != null"</span>&gt;</span>and country_code = #&#123;model.countryCode&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.phone != null"</span>&gt;</span>and phone = #&#123;model.phone&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        and status = 0</div><div class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"sort"</span> <span class="attr">index</span>=<span class="string">"col"</span> <span class="attr">collection</span>=<span class="string">"orderBy"</span></span></div><div class="line">             <span class="attr">open</span>=<span class="string">"ORDER BY"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">""</span>&gt;</div><div class="line">        $&#123;col&#125; $&#123;sort&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">    limit #&#123;startRow&#125;, #&#123;pageSize&#125;;</div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"count"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></div><div class="line">    select count(*) from user</div><div class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null"</span>&gt;</span>and id = #&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span>and username = #&#123;username&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span>and password = #&#123;password&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginCount != null"</span>&gt;</span>and login_count = #&#123;loginCount&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"loginTime != null"</span>&gt;</span>and login_time = #&#123;loginTime&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"countryCode != null"</span>&gt;</span>and country_code = #&#123;countryCode&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>and phone = #&#123;phone&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">        and status = 0</div><div class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样看起来简洁整齐得太多了！</p>
<p>这里面其实有很多重复的部分，不同的XML区别只有表名，实体类的完全限定名，实体类的驼峰与下划线属性名。</p>
<p>似乎只要写一个模板，把变的数据填充到模板渲染就能生成XML内容了，是的，我是这么实现的。Java的模板引擎有不少，这里我使用了apache的velocity模板引擎。</p>
<p>现在创建XmlData类用来定义填充到velocity模板引擎的数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlData</span> </span>&#123;</div><div class="line">    <span class="comment">/** 表名 */</span></div><div class="line">    <span class="keyword">public</span> String tableName;</div><div class="line">    <span class="comment">/** dao类完全限定名称 */</span></div><div class="line">    <span class="keyword">public</span> String daoName;</div><div class="line">    <span class="comment">/** 实体类完全限定名称 */</span></div><div class="line">    <span class="keyword">public</span> String entityName;</div><div class="line">    <span class="comment">/** 逻辑删除字段名 status or deleted */</span></div><div class="line">    <span class="keyword">public</span> String deleteFieldName = <span class="string">"status"</span>;</div><div class="line">    <span class="comment">/** 字段元组 */</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> List&lt;Tuple&lt;String, String&gt;&gt; fields = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">    <span class="comment">// Getter</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中Tuple是一个元组，左边存类属性的驼峰名称，右边存下划线名称，也可以用LinkedHashMap<string, string="">代替（保持有序）。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple</span>&lt;<span class="title">L</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> L left;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> R right;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tuple</span><span class="params">(L left, R right)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.left = left;</div><div class="line">        <span class="keyword">this</span>.right = right;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> L <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> left;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getRight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> right;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></string,></p>
<p>现在暂时不关心XmlData对象怎么生成，假设数据存在。在<code>src/main/resources</code>目录创建mybatis-xml.vm的模板文件，在这个文件里你可以随心所欲编写自己喜欢的格式模板，我写的内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;  </div><div class="line"><span class="meta">&lt;!DOCTYPE mapper</span></div><div class="line">    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" </div><div class="line">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"$data.daoName"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultType</span>=<span class="string">"$data.entityName"</span>&gt;</span></div><div class="line">        select * from $data.tableName where id = #&#123;id&#125; and $data.deleteFieldName = 0;</div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteById"</span>&gt;</span></div><div class="line">        delete from $data.tableName where id = #&#123;id&#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"$data.entityName"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">        insert into $data.tableName</div><div class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></div><div class="line">#foreach($field in $data.fields)</div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"$field.left != null"</span>&gt;</span>$&#123;field.right&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#end</div><div class="line">            create_time,</div><div class="line">            update_time,</div><div class="line">            status</div><div class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"values ("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></div><div class="line">#foreach($field in $data.fields)</div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"$field.left != null"</span>&gt;</span>#&#123;$field.left&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#end</div><div class="line">            now(),</div><div class="line">            now(),</div><div class="line">            0</div><div class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"$data.entityName"</span>&gt;</span></div><div class="line">        update $data.tableName</div><div class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">#foreach($field in $data.fields)</div><div class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"$field.left != null"</span>&gt;</span>$field.right = #&#123;$field.left&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#end</div><div class="line">             update_time = now()</div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">        where id = #&#123;id&#125; and $data.deleteFieldName = 0;</div><div class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listByIds"</span> <span class="attr">resultType</span>=<span class="string">"$data.entityName"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and !ids.isEmpty()"</span>&gt;</span></div><div class="line">            select * from $data.tableName where id in </div><div class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">                #&#123;item&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">            and $data.deleteFieldName = 0</div><div class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">      </div><div class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"query_filter"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.id != null"</span>&gt;</span>and id = #&#123;model.id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#foreach($field in $data.fields)</div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"model.$field.left != null"</span>&gt;</span>and $field.right = #&#123;model.$field.left&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#end</div><div class="line">        and $data.deleteFieldName = 0</div><div class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"count_filter"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null"</span>&gt;</span>and id = #&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#foreach($field in $data.fields)</div><div class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"$field.left != null"</span>&gt;</span>and $field.right = #&#123;$field.left&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">#end</div><div class="line">        and $data.deleteFieldName = 0</div><div class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"list"</span> <span class="attr">resultType</span>=<span class="string">"$data.entityName"</span> &gt;</span></div><div class="line">        select * from $data.tableName</div><div class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"query_filter"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"sort"</span> <span class="attr">index</span>=<span class="string">"col"</span> <span class="attr">collection</span>=<span class="string">"orderBy"</span></span></div><div class="line">                 <span class="attr">open</span>=<span class="string">"ORDER BY"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">""</span>&gt;</div><div class="line">            $&#123;col&#125; $&#123;sort&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line">        limit #&#123;startRow&#125;, #&#123;pageSize&#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"count"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></div><div class="line">        select count(*) from $data.tableName</div><div class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"count_filter"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">  </div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这里使用两个<code>&lt;sql&gt;&lt;/sql&gt;</code>节点，把查询条件独立出来是为了能够复用查询条件，使用<code>&lt;include refid=&quot;&quot;/&gt;</code>引用。</p>
<p>剩下的工作就是生成DataXML对象。需要的数据如下：</p>
<ul>
<li>tableName 表名</li>
<li>daoName dao类完全限定名称</li>
<li>entityName 实体类完全限定名称</li>
<li>fields 字段驼峰与蛇形元组</li>
</ul>
<p>除了表名，剩下的使用反射即可获取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisXmlGenerator</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> VelocityEngine engine = <span class="keyword">new</span> VelocityEngine();</div><div class="line">    </div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        engine.setProperty(RuntimeConstants.RESOURCE_LOADER, <span class="string">"classpath"</span>);</div><div class="line">        engine.setProperty(<span class="string">"classpath.resource.loader.class"</span>, ClasspathResourceLoader.class.getName());</div><div class="line">        engine.init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> templateName vm模板文件名</div><div class="line">     * <span class="doctag">@param</span> tableName 表名</div><div class="line">     * <span class="doctag">@param</span> DaoClz Dao类</div><div class="line">     * <span class="doctag">@param</span> entityClz 实体类</div><div class="line">     * <span class="doctag">@param</span> ignoreFields 忽略的实体字段</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateXml</span><span class="params">(String templateName, String tableName, Class&lt;?&gt; DaoClz, Class&lt;?&gt; entityClz, String... ignoreFields)</span> </span>&#123;</div><div class="line">        Set&lt;String&gt; ignoresSet = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">        Collections.addAll(ignoresSet, ignoreFields);</div><div class="line">        </div><div class="line">        XmlData data = <span class="keyword">new</span> XmlData();</div><div class="line">        data.tableName = tableName;</div><div class="line">        data.entityName = entityClz.getCanonicalName();</div><div class="line">        data.daoName = DaoClz.getCanonicalName();</div><div class="line"></div><div class="line">        <span class="comment">// Field[] fields = FieldUtils.getAllFields(entityClz); // 获取包含父类的属性</span></div><div class="line">        Field[] fields = entityClz.getDeclaredFields();</div><div class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</div><div class="line">            <span class="keyword">if</span> (Modifier.isStatic(field.getModifiers()) || ignoresSet.contains(field.getName()))</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            data.fields.add(<span class="keyword">new</span> Tuple&lt;&gt;(field.getName(), getSnakeCase(field.getName())));</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        VelocityContext ctx = <span class="keyword">new</span> VelocityContext();</div><div class="line">        ctx.put(<span class="string">"data"</span>, data);</div><div class="line">        StringWriter writer = <span class="keyword">new</span> StringWriter();</div><div class="line">        Template template = engine.getTemplate(templateName, <span class="string">"UTF-8"</span>);</div><div class="line">        template.merge(ctx, writer);</div><div class="line">        <span class="keyword">return</span> writer.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** 驼峰转下划线 */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSnakeCase</span><span class="params">(String camelCase)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (camelCase == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        Pattern pattern = Pattern.compile(<span class="string">"[A-Z]?[a-z]*[^A-Z]"</span>);</div><div class="line">        Matcher matcher = pattern.matcher(camelCase);</div><div class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">            sb.append(matcher.group().toLowerCase()).append(<span class="string">"_"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sb.length() &gt; <span class="number">0</span> ? sb.substring(<span class="number">0</span>, sb.length() - <span class="number">1</span>) : <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String xml = <span class="keyword">null</span>;</div><div class="line">        xml = generateXml(<span class="string">"mybatis-xml.vm"</span>, <span class="string">"user"</span>, UserDao.class, User.class);</div><div class="line"></div><div class="line">        System.out.println(xml);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>总结一下使用流程：</p>
<ol>
<li>写实体类</li>
<li>写DAO</li>
<li>生成XML</li>
</ol>
<p>如何在项目里使用？</p>
<p>对于maven多模块项目，将代码放在能够引用到实体类与DAO类的地方，或者新建maven module在pom.xml引用实体类与DAO模块即可。</p>
<p>文章最后，如果你也不想写DAO类的CRUD方法，那么可以尝试使用模板生成，发挥你的想象力，把一切枯燥的东西用模板去生成吧。</p>
<p>Gihub完整代码：<a href="https://github.com/Dog-Lee/mybatis-xml-generator" target="_blank" rel="external">https://github.com/Dog-Lee/mybatis-xml-generator</a></p>
</div></div></div></div><div class="pure-u-6-24 pure_cell"><div id="sidebar"><div class="widget"><div class="widget-title">我的微信</div><ul class="category-list"><img src="/images/wx_qrcode.jpg" style="width:100%"></ul></div><div class="widget"><div class="widget-title"> 分类<!-- i(class='fa fa-folder-o')= ' ' + __('categories')--></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/料理/">料理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li></ul></div><div class="widget"><div class="widget-title"> 最新</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/16/2017/">2017年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/06/mybatis-xml-generator/">一起来写最好用的MybatisXML生成工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/27/煲一碗汤/">煲一碗美味的汤</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/03/demo2小结/">demo2小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/28/demo0小结/">demo0小结</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div></div></div></div></div></div><div id="footer"> © 2018 <a href="/." rel="nofollow">阿狗.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme by<a rel="nofollow" target="_blank" href="https://chopstack.com/"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>